# DOU-monitor

## Goal
Monitor DOU (Diario Oficial da Uniao) publications for concurso-related results, with fast preview and optional PDF export.

## Capabilities
- Scrapes DOU search results using the site embedded JSON data
- Handles connection retries and timeouts
- Filters results by keywords (abertura, inicio, iniciado)
- Preview mode prints the first 10 lines per result
- PDF export uses the site print layout for high fidelity output
- PDF export reuses a browser context with realistic locale and timezone

## How to Run
- Install dependencies and Playwright browsers (see below)
- Run the main script from the project root
- Use the `--export-pdf` flag to save PDFs, or omit it for preview (title-only) mode

CLI highlights
- `--export-pdf`: save print-quality PDFs (requires Playwright and browsers)
- `--days` / `-d`: change lookback window in days (default: 7)

Example
```bash
python src/main.py            # preview (shows titles only)
python src/main.py -d 14      # preview last 14 days
python src/main.py -d 30 --export-pdf  # export PDFs for last 30 days
```

Additional tools and workflow
- **Extraction (PDF → JSON):** After exporting PDFs the project can automatically extract structured summaries. The extractor saves summaries to `data/summaries/`.

- **Review CSV (human-in-the-loop):** Generate a CSV for manual review with:

```bash
.venv/bin/python src/review_cli.py --summaries-dir data/summaries
```

This writes `data/review_<timestamp>.csv` listing each summary, a confidence score and flagged issues.

- **Apply reviewed CSV:** After editing the CSV, apply corrections back to JSON summaries (dry-run by default):

```bash
.venv/bin/python src/apply_review.py --csv data/review_YYYYMMDDTHHMMSSZ.csv
```

To actually write changes and create backups use `--apply` and set a reviewer name:

```bash
.venv/bin/python src/apply_review.py --csv data/review_YYYYMMDDTHHMMSSZ.csv --apply --reviewer "SeuNome"
```

Files and folders
- `editais/` — saved PDFs generated by the scraper (print-quality via Playwright)
- `data/summaries/` — JSON summaries extracted from each PDF
- `data/review_*.csv` — generated CSVs for manual review
- `data/backups/` — backups created when applying CSV corrections

Dependencies (recommended)
- `pdfplumber` — PDF text and table extraction
- `dateparser` — normalize dates in Portuguese
- `playwright` — PDF export (Python package) and browser engines

Install
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
# install Playwright browser engines
python -m playwright install
```

Developer debugging guide
- A step-by-step walkthrough is available at `docs/debugger_walkthrough.md` (ignored by Git by default). It explains the pipeline flow, main functions to inspect, and quick interactive checks for common problems.

## Output
- Console summary with counts and result metadata
- Optional PDFs saved under the editais folder
